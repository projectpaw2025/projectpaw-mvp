<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>관리자 로그인</title>
<link rel="stylesheet" href="common.css"/>
<link rel="stylesheet" href="app.min.css"/>
<style>
.wrap{max-width:400px;margin:0 auto;padding:40px 16px;text-align:center}
form{display:grid;gap:14px;margin-top:20px}
input{padding:10px;border:1px solid #e5e7eb;border-radius:10px}
button{padding:10px;border-radius:10px;background:#111;color:#fff;cursor:pointer}
.error{color:#dc2626;font-size:.9rem;margin-top:10px}
</style>
</head>
<body>
  <main class="wrap">
    <h1>관리자 로그인</h1>
    <p>이메일과 비밀번호로 로그인하세요.</p>
    <form id="loginForm">
      <input type="email" id="email" placeholder="이메일" required/>
      <input type="password" id="password" placeholder="비밀번호" required/>
      <button type="submit">로그인</button>
      <div id="error" class="error"></div>
    </form>
  </main>

  <script type="module">
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { app } from "./js/firebase.js";

    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById("loginForm");
    const errorDiv = document.getElementById("error");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorDiv.textContent = "";

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        console.log("로그인 성공:", user.uid);

        // Firestore에서 admin 여부 확인
        const adminRef = doc(db, "admins", user.uid);
        const adminSnap = await getDoc(adminRef);

        if (adminSnap.exists() && adminSnap.data().role === "admin") {
          console.log("✅ 관리자 권한 확인됨");
          window.location.href = "admin.html";
        } else {
          errorDiv.textContent = "⚠️ 관리자 권한이 없는 계정입니다.";
        }

      } catch (err) {
        console.error("로그인 실패:", err);
        errorDiv.textContent = "로그인 실패: " + (err.message || "");
      }
    });
  </script>
</body>
</html>
