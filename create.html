<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>후원 등록 · Project.PAW</title>
  <link rel="stylesheet" href="css/app.css" />
</head>
<body>
  <nav class="nav">
    <div class="container">
      <div class="brand"><a href="index.html">Project<span class="dot">.PAW</span></a></div>
      <ul>
        <li><a href="index.html">홈</a></li>
        <li><a href="project_list.html">후원하기</a></li>
        <li><a href="create.html" class="btn">후원 등록</a></li>
      </ul>
    </div>
  </nav>
  <main class="container">
  <section class="section">
    <h2>후원 등록</h2>
    <p style="color:#445;">실제 사례만 등록해주세요. <b>구조자 30% 자부담</b>과 <b>영수증/후기 공개</b>가 원칙입니다.</p>

    <div class="form">
      <label class="title">프로젝트명 / 고양이 이름</label>
      <input id="title" class="input" placeholder="예: 나비 – 교통사고 치료비" />

      <label class="title">상황 요약 (한 줄)</label>
      <input id="summary" class="input" placeholder="예: 수술비 60만원 중 40만원 모금 요청" />

      <label class="title">상세 설명</label>
      <textarea id="description" placeholder="상세 상황과 필요한 치료/비용을 적어주세요. 후기 공개를 약속합니다."></textarea>

      <div class="grid-2">
        <div>
          <label class="title">목표 금액 (원)</label>
          <input id="target" type="number" class="input" placeholder="예: 400000" />
        </div>
        <div>
          <label class="title">구조자 부담금 (원)</label>
          <input id="selfpay" type="number" class="input" placeholder="예: 200000" />
        </div>
      </div>

      <label class="title">카카오톡 연결 링크</label>
      <input id="kakao" class="input" placeholder="https://open.kakao.com/o/..." />

      <div class="switch">
        <input id="status" type="checkbox">
        <span>관리자 승인</span>
      </div>

      <label class="title">대표 이미지</label>
      <input id="cover" type="file" accept="image/*" class="input"/>
      <div class="img-preview"><img id="coverPreview" alt="대표 미리보기" /></div>

      <label class="title">상황 사진 (여러 장)</label>
      <input id="gallery" type="file" accept="image/*" multiple class="input"/>
      <div class="gallery-preview grid"></div>

      <label class="title">영수증 사진 (여러 장)</label>
      <input id="receipts" type="file" accept="image/*" multiple class="input"/>
      <div class="receipt-preview grid"></div>

      <div>
        <button id="saveBtn" class="btn primary">등록하기</button>
      </div>
    </div>
  </section>

  <script type="module">
    import { SCHEMA, storage, uid } from "./js/app.js";
    import "./js/uploader.js";

    document.querySelector("#saveBtn").addEventListener("click", (e) => {
      e.preventDefault();
      const data = structuredClone(SCHEMA);
      data.id = uid();
      data.title = document.querySelector("#title").value.trim();
      data.summary = document.querySelector("#summary").value.trim();
      data.description = document.querySelector("#description").value.trim();
      data.targetAmount = Number(document.querySelector("#target").value || 0);
      data.selfPayAmount = Number(document.querySelector("#selfpay").value || 0);
      data.kakaoLink = document.querySelector("#kakao").value.trim();
      data.status = document.querySelector("#status").checked ? "approved" : "pending";
      const coverEl = document.querySelector("#coverPreview");
      data.images.cover = coverEl?.dataset?.src || "";
      data.images.gallery = [...document.querySelectorAll(".gallery-preview img")].map(img => img.dataset.src);
      data.images.receipts = [...document.querySelectorAll(".receipt-preview img")].map(img => img.dataset.src);
      data.createdAt = Date.now();

      if (!data.title || !data.summary) {
        alert("프로젝트명과 요약을 입력해주세요.");
        return;
      }
      storage.add(data);
      alert("등록 완료! 홈으로 이동합니다.");
      location.href = "index.html";
    });
  </script>

  </main>
  <footer class="footer">
    <div class="container">
      <small>Project.PAW — “도움은 본능, 연결은 선택.” 100% 전달 · 책임 구조 · 직접 연결</small>
    </div>
  </footer>
</body>
</html>
