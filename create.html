<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>프로젝트 등록 — Project.PAW</title>
  <link rel="stylesheet" href="common.css"/>
</head>
<body>
  <header style="background:white; border-bottom:1px solid #e5e7eb">
    <div class="container-narrow" style="display:flex; align-items:center; justify-content:space-between; padding:14px 0">
      <a class="navbar-brand" href="index.html"><strong>Project.PAW</strong></a>
      <nav class="toolbar">
        <a class="btn secondary" href="index.html">홈</a>
        <a class="btn secondary" href="project_list.html">후원하기</a>
      </nav>
    </div>
  </header>

  <main class="container-narrow" style="padding:24px 0">
    <h2 class="section-title">프로젝트 등록</h2>
    <form id="form" class="form-grid">
      <div><label>동물 이름</label><input name="name" type="text" placeholder="예: 나비" required/></div>
      <div><label>구조자 이름</label><input name="rescuerName" type="text" placeholder="예: 홍길동" required/></div>
      <div class="full"><label>상황 요약</label><input name="summary" type="text" placeholder="짧은 한 줄 요약" required/></div>
      <div class="full"><label>상세 설명</label><textarea name="description" rows="6" placeholder="무슨 일이 있었는지, 필요한 치료와 비용 등을 적어주세요." required></textarea></div>
      <div><label>목표 금액(원)</label><input name="goalAmount" type="number" min="0" step="1000" placeholder="예: 600000" required/></div>
      <div><label>구조자 부담액(원)</label><input name="rescuerContribution" type="number" min="0" step="1000" placeholder="예: 180000" required/></div>
      <div><label>동물병원 이름</label><input name="hospitalName" type="text" placeholder="예: ○○동물병원" disabled value="베타 단계 — 추후 PG 연동"/></div>
      <div><label>계좌번호(참고)</label><input name="bankAccount" type="text" placeholder="PG 연동 전까지만 참고용" disabled/></div>
      <div class="full"><label>카카오톡 초대링크</label><input name="kakaoInviteLink" type="url" placeholder="https://open.kakao.com/o/xxxxxx" required/></div>
      <div class="full"><label>대표 사진 (1장)</label><input id="repImage" type="file" accept="image/*" required/></div>
      <div class="full"><label>구조 상황 사진 (여러 장)</label><input id="situationImages" type="file" accept="image/*" multiple/></div>
      <div class="full"><label>영수증 사진 (여러 장)</label><input id="receiptImages" type="file" accept="image/*" multiple/></div>
      <div class="full" style="display:flex; gap:8px; justify-content:flex-end"><a class="btn secondary" href="index.html">취소</a><button class="btn" type="submit">등록하기</button></div>
    </form>
  </main>

  <script src="paw.js"></script>
  <script>
    const form = document.querySelector('#form');
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(form);
      const repFile = document.querySelector('#repImage').files[0];
      const situationFiles = document.querySelector('#situationImages').files;
      const receiptFiles = document.querySelector('#receiptImages').files;
      const repData = repFile ? (await parseFilesToDataURLs([repFile]))[0] : null;
      const situationData = await parseFilesToDataURLs(situationFiles);
      const receiptData = await parseFilesToDataURLs(receiptFiles);
      const p = {
        id: Date.now().toString(), createdAt: Date.now(),
        name: fd.get('name'), rescuerName: fd.get('rescuerName'),
        summary: fd.get('summary'), description: fd.get('description'),
        goalAmount: Number(fd.get('goalAmount')||0), rescuerContribution: Number(fd.get('rescuerContribution')||0),
        hospitalName: fd.get('hospitalName'), bankAccount: fd.get('bankAccount'),
        kakaoInviteLink: fd.get('kakaoInviteLink'),
        representativeImage: repData, gallery: situationData, receipts: receiptData,
        raisedAmount: 0, adminApproved: false
      };
      upsertProject(p);
      location.href = 'project.html?id=' + encodeURIComponent(p.id);
    });
  </script>
</body>
</html>
