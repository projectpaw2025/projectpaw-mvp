<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>í”„ë¡œì íŠ¸ ë“±ë¡ - Project.PAW</title>
<link rel="stylesheet" href="common.css"/>
<link rel="stylesheet" href="app.min.css"/>
<link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"/>
<style>
  :root{--ink:#111;--sub:#555;--accent:#E87722;--line:#eaeaea;--bg:#fff;}
  body{background:#fafafa;font-family:'SUIT Variable','Pretendard',system-ui,sans-serif;color:var(--ink);margin:0}
  .wrap{max-width:880px;margin:0 auto;padding:30px 16px}
  h1{font-size:2rem;font-weight:900;margin-bottom:24px;color:var(--ink);text-align:center}

  form{display:flex;flex-direction:column;gap:24px}
  .form-section{background:#fff;border-radius:16px;padding:24px 28px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);border:1px solid var(--line)}
  .form-section h2{font-size:1.2rem;font-weight:800;margin:0 0 14px;color:var(--ink)}

  label{font-weight:700;margin:10px 0 6px;display:block}
  input,textarea{width:100%;padding:12px 14px;border:1px solid #ddd;border-radius:10px;
    font-size:1rem;line-height:1.4}
  input:focus,textarea:focus{border-color:var(--accent);outline:none;box-shadow:0 0 0 2px rgba(232,119,34,0.2)}
  textarea{min-height:350px;resize:vertical}
  .grid2{display:grid;gap:16px;grid-template-columns:1fr 1fr}
  @media(max-width:760px){.grid2{grid-template-columns:1fr}}

  .note{color:#666;font-size:.85rem;margin-top:4px}
  .upload-box{border:2px dashed #ddd;border-radius:12px;padding:20px;text-align:center;
    color:#666;cursor:pointer;transition:.2s}
  .upload-box:hover{border-color:var(--accent);background:#fff7f2;color:var(--accent)}
  .preview{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  .preview img{width:110px;height:110px;object-fit:cover;border-radius:10px;border:1px solid #ddd}

  .actions{display:flex;gap:12px;justify-content:flex-end}
  .btn{padding:12px 20px;border-radius:10px;font-weight:700;cursor:pointer;text-decoration:none;border:none}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.primary:hover{background:#c85e12}
  .btn.ghost{background:#f5f5f5;color:#444}
</style>
</head>
<body>
  <div data-include="header"></div>

  <main class="wrap">
    <h1>ğŸ¾ í”„ë¡œì íŠ¸ ë“±ë¡</h1>
    <form id="form">

      <!-- ê¸°ë³¸ ì •ë³´ -->
      <div class="form-section">
        <h2>1. ê¸°ë³¸ ì •ë³´</h2>
        <div class="grid2">
          <div>
            <label>ë™ë¬¼ ì´ë¦„</label>
            <input name="name" placeholder="ì˜ˆ: ì´ˆì½”" required/>
          </div>
          <div>
            <label>êµ¬ì¡°ì ì´ë¦„</label>
            <input name="rescuerName" placeholder="ì˜ˆ: ê¹€ì² ìˆ˜" required/>
          </div>
        </div>
      </div>

      <!-- í”„ë¡œì íŠ¸ ì†Œê°œ -->
      <div class="form-section">
        <h2>2. í”„ë¡œì íŠ¸ ì†Œê°œ</h2>
        <label>ìƒí™© ìš”ì•½</label>
        <input name="summary" placeholder="ì˜ˆ: êµí†µì‚¬ê³ ë¡œ ë‹¤ì¹œ ê°•ì•„ì§€ ì¹˜ë£Œë¹„ ëª¨ê¸ˆ" required/>
        <div class="note">ğŸ‘‰ í•œ ì¤„ ìš”ì•½ì€ ì¹´ë“œ/ìƒë‹¨ì—ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</div>

        <label>í•µì‹¬ í•œ ì¤„ (ì„ íƒ)</label>
        <input name="keyMessage" placeholder="ì˜ˆ: ëˆë³´ë‹¤ ìƒëª…ì´ ë¨¼ì €ì˜€ìŠµë‹ˆë‹¤."/>

        <label>ìƒì„¸ ì„¤ëª…</label>
        <textarea name="description" id="desc" maxlength="1000" required>ğŸ¾ ì–¸ì œ, ì–´ë””ì„œ ë°œê²¬í–ˆë‚˜ìš”?  
ğŸ¯ í˜„ì¬ ì–´ë–¤ ìƒíƒœì¸ê°€ìš”?  (êµ¬ì¡°í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤)  
ğŸ“¸ ì°¸ê³ í•  ìˆ˜ ìˆëŠ” ì¸ìŠ¤íƒ€/ë¸”ë¡œê·¸ ë§í¬ê°€ ìˆë‹¤ë©´ í•¨ê»˜ ì ì–´ì£¼ì„¸ìš”.
        </textarea>
        <div class="note"><span id="descCount">0</span> / 1000ì</div>
      </div>

      <!-- ê¸ˆì•¡ -->
      <div class="form-section">
        <h2>3. ëª©í‘œ ê¸ˆì•¡</h2>
        <div class="grid2">
          <div>
            <label>ëª©í‘œ ê¸ˆì•¡</label>
            <input type="text" id="goalAmount" placeholder="ì˜ˆ: 500,000ì›" required/>
          </div>
          <div>
            <label>êµ¬ì¡°ì ë¶€ë‹´ì•¡</label>
            <input type="text" id="rescuerContribution" placeholder="ì˜ˆ: 100,000ì›" required/>
          </div>
        </div>
        <div class="note">ğŸ‘‰ êµ¬ì¡°ìê°€ ì¼ë¶€ ë¶€ë‹´í•´ì•¼ ë“±ë¡ ê°€ëŠ¥ (ì±…ì„ì„± ì›ì¹™)</div>
      </div>

      <!-- ì†Œí†µ -->
      <div class="form-section">
        <h2>4. ì†Œí†µ ì •ë³´</h2>
        <label>ì—°ë½ì²˜ (ì¹´ì¹´ì˜¤í†¡ ID ë˜ëŠ” ì „í™”ë²ˆí˜¸)</label>
        <input name="privateContact" required/>
        <div class="note">ğŸ‘‰ ê´€ë¦¬ìì—ê²Œë§Œ ë³´ì´ë©°, ì „ì²´ ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
      </div>

      <!-- ì´ë¯¸ì§€ -->
      <div class="form-section">
        <h2>5. ì‚¬ì§„ ì—…ë¡œë“œ</h2>
        <label>ëŒ€í‘œ ì‚¬ì§„</label>
        <input type="file" id="repImage" accept="image/*" required class="upload-box"/>
        <div class="preview" id="previewRep"></div>
        <label>êµ¬ì¡° ìƒí™© ì‚¬ì§„</label>
        <input type="file" id="situationImages" accept="image/*" multiple class="upload-box"/>
        <div class="preview" id="previewSituation"></div>
        <label>ì˜ìˆ˜ì¦ ì‚¬ì§„</label>
        <input type="file" id="receiptImages" accept="image/*" multiple class="upload-box"/>
        <div class="preview" id="previewReceipt"></div>
        <div class="note">ğŸ‘‰ ì§„ë£Œë¹„Â·ì¹˜ë£Œë¹„ ì¦ë¹™ìš© ì˜ìˆ˜ì¦ (íˆ¬ëª…ì„± í™•ë³´)</div>
      </div>

      <div class="actions">
        <a class="btn ghost" href="index.html">ì·¨ì†Œ</a>
        <button class="btn primary" type="submit" id="submitBtn">ë“±ë¡í•˜ê¸°</button>
      </div>
    </form>
  </main>

  <div data-include="footer"></div>

  <script type="module">
    import { injectLayout } from './js/include.js';
    import { apiCreateProject } from './js/api.js';
    import { authReady } from './js/firebase.js';
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    injectLayout({ active:'create' });

    const form=document.getElementById('form');
    const submitBtn=document.getElementById('submitBtn');
    const desc=document.getElementById('desc');
    const descCount=document.getElementById('descCount');
    const auth=getAuth();

    desc.addEventListener('input',()=>{descCount.textContent=desc.value.length;});

    form.addEventListener('submit',async(e)=>{
      e.preventDefault();
      await authReady;

      // âœ… ë¡œê·¸ì¸ ì²´í¬ ì¶”ê°€
      if (!auth.currentUser) {
        alert("âš ï¸ í”„ë¡œì íŠ¸ ë“±ë¡ì€ ë¡œê·¸ì¸ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        return;
      }

      submitBtn.classList.add('disabled');
      submitBtn.textContent='ì—…ë¡œë“œ ì¤‘...';

      try{
        const fd=new FormData(form);
        const projectData={
          name:fd.get("name"),
          rescuerName:fd.get("rescuerName"),
          summary:fd.get("summary"),
          keyMessage:fd.get("keyMessage"),
          description:fd.get("description"),
          goalAmount:document.getElementById("goalAmount").dataset.value||0,
          rescuerContribution:document.getElementById("rescuerContribution").dataset.value||0,
          privateContact:fd.get("privateContact"),
          coverFile:document.getElementById('repImage').files[0]||null,
          galleryFiles:Array.from(document.getElementById('situationImages').files),
          receiptFiles:Array.from(document.getElementById('receiptImages').files)
        };
        const savedId=await apiCreateProject(projectData);
        location.href='project.html?id='+encodeURIComponent(savedId);
      }catch(err){
        alert('ì—…ë¡œë“œ ì‹¤íŒ¨: '+(err.message||'')); 
      }finally{
        submitBtn.classList.remove('disabled');
        submitBtn.textContent='ë“±ë¡í•˜ê¸°';
      }
    });

    // ê¸ˆì•¡ ì…ë ¥ ì²œë‹¨ìœ„ ì½¤ë§ˆ ìë™í™”
    function setupCurrencyInput(id){
      const el=document.getElementById(id);
      el.addEventListener('input',()=>{
        let v=el.value.replace(/[^0-9]/g,'');
        if(v===''){delete el.dataset.value;el.value='';return;}
        el.dataset.value=v;
        el.value=Number(v).toLocaleString('ko-KR')+'ì›';
      });
    }
    setupCurrencyInput("goalAmount");
    setupCurrencyInput("rescuerContribution");

    // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
    function setupPreview(inputId,previewId){
      const input=document.getElementById(inputId);
      const preview=document.getElementById(previewId);
      input.addEventListener('change',()=>{
        preview.innerHTML='';
        Array.from(input.files).forEach(file=>{
          const reader=new FileReader();
          reader.onload=e=>{
            const img=document.createElement('img');
            img.src=e.target.result;
            preview.appendChild(img);
          };
          reader.readAsDataURL(file);
        });
      });
    }
    setupPreview("repImage","previewRep");
    setupPreview("situationImages","previewSituation");
    setupPreview("receiptImages","previewReceipt");
  </script>
</body>
</html>
