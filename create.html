<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("projectForm");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    const name = document.getElementById("animalName").value;
    const situation = document.getElementById("situation").value;
    const goalAmount = parseInt(document.getElementById("goalAmount").value);
    const ownerAmount = parseInt(document.getElementById("ownerAmount").value);
    const kakaoLink = document.getElementById("kakaoLink").value;

    // 이미지들을 base64로 변환
    async function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // 대표사진
    const representativeImageInput = document.getElementById("representativeImage");
    const representativeImage = representativeImageInput.files.length > 0
      ? await toBase64(representativeImageInput.files[0])
      : "https://placekitten.com/400/250"; // 기본 이미지

    // 구조상황 사진들
    const situationImagesInput = document.getElementById("situationImages");
    const situationImages = [];
    for (let file of situationImagesInput.files) {
      situationImages.push(await toBase64(file));
    }

    // 영수증 사진들
    const receiptImagesInput = document.getElementById("receiptImages");
    const receiptImages = [];
    for (let file of receiptImagesInput.files) {
      receiptImages.push(await toBase64(file));
    }

    // 최종 프로젝트 객체 생성
    const project = {
      id: new Date().getTime(),
      name,
      situation,
      goalAmount,
      ownerAmount,
      currentAmount: 0,
      kakaoLink,
      representativeImage,
      situationImages,
      receiptImages
    };

    // localStorage에 저장
    const existing = JSON.parse(localStorage.getItem("projects") || "[]");
    existing.push(project);
    localStorage.setItem("projects", JSON.stringify(existing));

    alert("프로젝트가 등록되었습니다!");
    window.location.href = "index.html";
  });
});
</script>
