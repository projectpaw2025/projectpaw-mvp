<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>í”„ë¡œì íŠ¸ ë“±ë¡</title>
  <link rel="stylesheet" href="common.css"/><link rel="stylesheet" href="app.min.css"/>
  <style>
    .wrap{max-width:860px;margin:0 auto;padding:20px 16px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .grid2>div{display:flex;flex-direction:column}
    label{font-weight:700;margin:14px 0 6px}
    input,textarea{border:1px solid #e7e7e7;border-radius:12px;padding:12px}
    textarea{min-height:140px}
    .note{color:#888;font-size:.9rem;margin-top:8px}
    .actions{display:flex;gap:8px;margin-top:16px}
    .btn{display:inline-block;padding:12px 18px;border-radius:12px;font-weight:700;text-decoration:none;cursor:pointer}
    .btn.ghost{background:#fff;border:1px solid #ddd;color:#111}
    .btn.primary{background:#111;color:#fff}
    .disabled{opacity:.6;pointer-events:none}
    @media (max-width:720px){.grid2{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div data-include="header"></div>
  <script type="module">
    import { injectLayout } from './js/include.js';
    injectLayout();
  </script>

  <main class="wrap">
    <h1 style="margin:0 0 6px">í”„ë¡œì íŠ¸ ë“±ë¡</h1>
    <form id="form">
      <div class="grid2">
        <div><label>ë™ë¬¼ ì´ë¦„</label><input name="name" required/></div>
        <div><label>êµ¬ì¡°ì ì´ë¦„</label><input name="rescuerName" required/></div>
      </div>
      <div><label>ìƒí™© ìš”ì•½</label><input name="summary" required/></div>
      <div><label>ìƒì„¸ ì„¤ëª…</label><textarea name="description" required></textarea></div>
      <div class="grid2">
        <div><label>ëª©í‘œ ê¸ˆì•¡(ì›)</label><input type="number" name="goalAmount" min="0" required/></div>
        <div><label>êµ¬ì¡°ì ë¶€ë‹´ì•¡(ì›)</label><input type="number" name="rescuerContribution" min="0" required/></div>
      </div>
      <div><label>ë“±ë¡ì ì¹´ì¹´ì˜¤í†¡ ID</label><input name="registrantKakaoId" required/></div>
      <div><label>ëŒ€í‘œ ì‚¬ì§„ (1ì¥)</label><input type="file" id="repImage" accept="image/*" required/></div>
      <div><label>êµ¬ì¡° ìƒí™© ì‚¬ì§„ (ì—¬ëŸ¬ ì¥)</label><input type="file" id="situationImages" accept="image/*" multiple/></div>
      <div><label>ì˜ìˆ˜ì¦ ì‚¬ì§„ (ì—¬ëŸ¬ ì¥)</label><input type="file" id="receiptImages" accept="image/*" multiple/></div>
      <p class="note">* ë³‘ì›ëª…/ê³„ì¢Œ/ì¹´ì¹´ì˜¤í†¡ ì´ˆëŒ€ë§í¬ëŠ” <b>ê´€ë¦¬ì ì „ìš©</b> í™”ë©´ì—ì„œ ë“±ë¡ë©ë‹ˆë‹¤.</p>
      <div class="actions">
        <a class="btn ghost" href="index.html">ì·¨ì†Œ</a>
        <button class="btn primary" type="submit" id="submitBtn">ë“±ë¡í•˜ê¸°</button>
      </div>
    </form>
  </main>

  <div data-include="footer"></div>

  <script type="module">
    import { apiCreateProject } from './js/api.js';
    import { authReady } from './js/firebase.js';

    const form = document.getElementById('form');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      // ğŸ”’ Firestore/Storage rulesê°€ write ì‹œ auth ìš”êµ¬ â†’ ìµëª… ì¸ì¦ ë³´ì¥
      await authReady;

      submitBtn.classList.add('disabled');
      submitBtn.textContent = 'ì—…ë¡œë“œ ì¤‘...';

      try{
        const fd = new FormData(form);
        const rep = document.getElementById('repImage').files[0];
        const situ = document.getElementById('situationImages').files;
        const rcpt = document.getElementById('receiptImages').files;

        if(rep) fd.append('representativeImage', rep);
        Array.from(situ).forEach(f=>fd.append('situationImages', f));
        Array.from(rcpt).forEach(f=>fd.append('receiptImages', f));

        const saved = await apiCreateProject(fd);
        location.href = 'project.html?id='+encodeURIComponent(saved.id);
      }catch(err){
        alert('ì—…ë¡œë“œ ì‹¤íŒ¨: '+(err.message||''));
      }finally{
        submitBtn.classList.remove('disabled');
        submitBtn.textContent = 'ë“±ë¡í•˜ê¸°';
      }
    });
  </script>
</body>
</html>
