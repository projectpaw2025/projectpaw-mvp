<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>프로젝트 상세</title>
<link rel="stylesheet" href="common.css"/>
<link rel="stylesheet" href="app.min.css"/>
<style>
  .hero{text-align:center;padding:30px 16px}
  .hero h1{margin:0 0 10px;font-size:1.8rem;font-weight:800}
  .badge{display:inline-block;padding:6px 12px;border-radius:8px;background:#A47864;color:#fff;font-size:.9rem;font-weight:600;margin-bottom:10px}
  .progress{background:#eee;border-radius:6px;overflow:hidden;height:10px;margin:16px 0}
  .progress .bar{background:#A47864;height:100%}
  .stats{display:flex;justify-content:space-between;font-size:.9rem;color:#666;margin-bottom:18px}
  .stats span strong{font-size:1.1rem;font-weight:800;color:#111;margin-left:4px}
  .gallery{display:flex;flex-wrap:wrap;gap:10px}
  .gallery img{width:calc(33% - 8px);border-radius:10px;border:1px solid #ddd}
  @media(max-width:760px){
    .gallery img{width:100%}
  }
</style>
</head>
<body>
  <div data-include="header"></div>

  <main class="container" style="padding:24px 16px">
    <section class="hero">
      <span id="status" class="badge">상태</span>
      <h1 id="title">제목</h1>
      <img id="cover" src="img/placeholder.svg" alt="대표 이미지" style="max-width:100%;border-radius:16px;margin:16px 0"/>
      <div class="progress"><div id="progress-bar" class="bar" style="width:0%"></div></div>
      <div class="stats">
        <span>목표 <strong id="goal">0</strong>원</span>
        <span>달성 <strong id="current">0</strong>원</span>
        <span>참여자 <strong id="supporters">0</strong>명</span>
      </div>
    </section>

    <section>
      <h2>프로젝트 소개</h2>
      <p id="summary"></p>
      <p id="description"></p>
    </section>

    <section>
      <h2>사진</h2>
      <div id="gallery" class="gallery"></div>
    </section>
  </main>

  <div data-include="footer"></div>

  <script type="module">
    import { injectLayout } from './js/include.js';
    import { apiGetProject } from './js/api.js';
    import { storage } from './js/firebase.js';
    import { ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

    injectLayout();

    const fmt = n => Number(n||0).toLocaleString('ko-KR');

    async function load(){
      const params = new URLSearchParams(location.search);
      const id = params.get('id');
      if(!id) return;

      try{
        const p = await apiGetProject(id);
        if(!p) return;

        document.getElementById('title').textContent = p.name ?? '(제목 없음)';
        document.getElementById('summary').textContent = p.summary ?? '';
        document.getElementById('description').textContent = p.description ?? '';
        document.getElementById('goal').textContent = fmt(p.goalAmount);
        document.getElementById('current').textContent = fmt(p.currentAmount||0);
        document.getElementById('supporters').textContent = p.supporterCount ?? 0;
        document.getElementById('progress-bar').style.width = Math.min(100, Math.round((p.currentAmount||0)/p.goalAmount*100))+'%';
        document.getElementById('status').textContent = p.adminApproved ? '진행중' : '대기중';

        if(p.representativeImagePath){
          try{
            const url = await getDownloadURL(ref(storage, p.representativeImagePath));
            document.getElementById('cover').src = url;
          }catch(e){console.warn(e);}
        }

        if(Array.isArray(p.images)){
          const gallery = document.getElementById('gallery');
          for(const path of p.images){
            try{
              const url = await getDownloadURL(ref(storage, path));
              const img = document.createElement('img');
              img.src = url;
              gallery.appendChild(img);
            }catch(e){console.warn(e);}
          }
        }
      }catch(e){console.error(e);}
    }

    load();
  </script>
</body>
</html>
