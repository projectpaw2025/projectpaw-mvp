<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project.PAW - 상세보기</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- 헤더 -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold text-primary" href="index.html">
        <img src="images/logo_wordmark.svg" alt="Project.PAW" height="30"> Project.PAW
      </a>
      <div>
        <a class="btn btn-outline-primary btn-sm me-2" href="project_list.html">후원하기</a>
        <a class="btn btn-primary btn-sm" href="create.html">프로젝트 등록</a>
      </div>
    </div>
  </nav>

  <!-- 상세 콘텐츠 -->
  <main class="container my-5" id="projectDetail">
    <div class="row g-4">
      <!-- 대표사진 -->
      <div class="col-lg-6">
        <img id="mainImage" src="img/placeholder.svg" class="img-fluid rounded shadow-sm" alt="대표사진">
      </div>

      <!-- 상세 텍스트 -->
      <div class="col-lg-6">
        <h2 id="projectName" class="fw-bold">프로젝트 이름</h2>
        <p id="projectSituation" class="text-muted">상황 설명</p>
        <p class="fw-bold">목표 금액: <span id="projectGoal"></span> 원</p>
        <p><small class="text-muted">등록일: <span id="projectDate"></span></small></p>

        <button class="btn btn-primary btn-lg mt-3">후원하기</button>
      </div>
    </div>

    <!-- 갤러리 슬라이더 -->
    <section class="mt-5">
      <h4 class="mb-3 fw-bold">구조 상황 사진</h4>
      <div id="galleryCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner" id="galleryInner">
          <div class="carousel-item active">
            <img src="img/placeholder.svg" class="d-block w-100 rounded" alt="갤러리">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#galleryCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#galleryCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      </div>
    </section>
  </main>

  <!-- 푸터 -->
  <footer class="bg-light text-center py-4 mt-5 border-top">
    <small class="text-muted">© 2025 Project.PAW</small>
  </footer>

  <script type="module">
    import { db, doc, getDoc } from "./js/firebase.js";

    // URL에서 id 추출
    const urlParams = new URLSearchParams(window.location.search);
    const projectId = urlParams.get("id");

    async function loadProject() {
      if (!projectId) {
        alert("잘못된 접근입니다.");
        window.location.href = "index.html";
        return;
      }

      try {
        const docRef = doc(db, "projects", projectId);
        const snap = await getDoc(docRef);

        if (!snap.exists()) {
          alert("프로젝트를 찾을 수 없습니다.");
          window.location.href = "index.html";
          return;
        }

        const data = snap.data();

        // 대표사진
        document.getElementById("mainImage").src = data.mainImage || "img/placeholder.svg";

        // 텍스트
        document.getElementById("projectName").textContent = data.name;
        document.getElementById("projectSituation").textContent = data.situation;
        document.getElementById("projectGoal").textContent = (data.goalAmount || 0).toLocaleString();
        if (data.createdAt?.toDate) {
          document.getElementById("projectDate").textContent = data.createdAt.toDate().toLocaleDateString();
        }

        // 갤러리
        const galleryInner = document.getElementById("galleryInner");
        galleryInner.innerHTML = "";

        if (data.galleryImages && data.galleryImages.length > 0) {
          data.galleryImages.forEach((url, i) => {
            const item = document.createElement("div");
            item.className = `carousel-item ${i === 0 ? "active" : ""}`;
            item.innerHTML = `<img src="${url}" class="d-block w-100 rounded" alt="갤러리">`;
            galleryInner.appendChild(item);
          });
        } else {
          galleryInner.innerHTML = `
            <div class="carousel-item active">
              <img src="img/placeholder.svg" class="d-block w-100 rounded" alt="갤러리">
            </div>`;
        }

      } catch (err) {
        console.error("상세 불러오기 실패:", err);
        alert("불러오기 실패: " + err.message);
      }
    }

    document.addEventListener("DOMContentLoaded", loadProject);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!doctype html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>프로젝트 상세</title><link rel="stylesheet" href="common.css"/><link rel="stylesheet" href="app.min.css"/>
<style>.wrap{max-width:1040px;margin:0 auto;padding:20px 16px}.cover{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:16px;border:1px solid #eef2f7}.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}.thumb{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:10px;border:1px solid #eef2f7}</style>
</head><body><div data-include="header"></div><main class="wrap" id="app"></main><div data-include="footer"></div>
<script type="module">
import { injectLayout } from './js/include.js'; import { apiGetProject } from './js/api.js'; injectLayout();
const $app=document.getElementById('app'); const id=new URL(location.href).searchParams.get('id'); const cover=p=>p.coverUrl||p.representativeImageUrl||'img/placeholder.svg'; const fmt=n=>Number(n||0).toLocaleString('ko-KR');
(async()=>{ try{ const p=await apiGetProject(id); const g=p.galleryUrls||[]; const r=p.receiptUrls||[]; $app.innerHTML = `
  <img class="cover" src="${cover(p)}"/><h1>${p.name??'(이름 없음)'} ${p.adminApproved?'<span class="pill" style="background:#ecfdf5;border-color:#bbf7d0;color:#065f46">승인</span>':'<span class="pill" style="background:#fff7ed;border-color:#fed7aa;color:#9a3412">대기</span>'}</h1>
  <div class="muted">목표 ${fmt(p.goalAmount)}원 · 구조자 부담 ${fmt(p.rescuerContribution)}원</div>
  <h3>상황 요약</h3><p>${p.summary??''}</p>
  <h3>상세 설명</h3><p>${(p.description??'').replace(/\n/g,'<br/>')}</p>
  ${g.length?'<h3>구조 상황 사진</h3><div class="grid">'+g.map(s=>`<img class="thumb" src="${s}">`).join('')+'</div>':''}
  ${r.length?'<h3>영수증</h3><div class="grid">'+r.map(s=>`<img class="thumb" src="${s}">`).join('')+'</div>':''}`; }catch(e){ $app.innerHTML='<p>불러오기 실패</p>'; } })();
</script></body></html>
