<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>프로젝트 상세 · Project.PAW</title>
<meta name="description" content="프로젝트 상세 정보, 갤러리, 영수증, 그리고 직접 연결 안내를 확인하세요." />
<link rel="icon" href="img/placeholder.svg" />

  <link rel="stylesheet" href="css/app.css" />
</head>
<body>
  <nav class="nav">
    <div class="container">
      <div class="brand"><a href="index.html">Project<span class="dot">.PAW</span></a></div>
      <ul>
        <li><a href="index.html">홈</a></li>
        <li><a href="project_list.html">후원하기</a></li>
        <li><a href="create.html" class="btn">후원 등록</a></li>
      </ul>
    </div>
  </nav>
  <main class="container">
  <section class="project-hero">
    <img class="project-cover cover" alt="cover">
    <h1 class="project-title"></h1>
    <p class="project-summary"></p>
    <p class="project-money"></p>
    <div class="fixed-actions sticky-cta">
      <a id="kakaoBtn" class="btn primary hidden" target="_blank" rel="noopener">카카오톡으로 연결</a>
    </div>
  </section>

  <section class="project-gallery section">
    <h2>상황 갤러리</h2>
    <div class="slider">
      <button class="btn-prev" aria-label="이전">‹</button>
      <div class="slider-window"><div class="slider-track"></div></div>
      <button class="btn-next" aria-label="다음">›</button>
    </div>
  </section>

  <section class="section">
    <h2>상세 내용</h2>
    <div class="desc"></div>
  </section>

  <section class="section">
    <h2>영수증</h2>
    <div class="receipt-preview grid"></div>
  </section>

  <script type="module">
    import { storage, fmt } from "./js/app.js";
    const $ = (s, p=document) => p.querySelector(s);

    const id = new URLSearchParams(location.search).get("id");
    const p = storage.byId(id);
    if (!p) {
      document.body.innerHTML = "<main class='container'><p>프로젝트를 찾을 수 없습니다.</p></main>";
      throw new Error("Project not found");
    }

    $(".project-title").textContent = p.title || "";
    $(".project-summary").textContent = p.summary || "";
    $(".project-cover").src = p.images?.cover || "img/placeholder.svg";
    $(".project-money").textContent = `목표 ${fmt(p.targetAmount)}원 · 구조자 ${fmt(p.selfPayAmount)}원`;
    $(".desc").textContent = p.description || "";

    const kakaoBtn = $("#kakaoBtn");
    if (p.kakaoLink) {
      kakaoBtn.href = p.kakaoLink;
      kakaoBtn.classList.remove("hidden");
    }

    // Gallery slider
    const g = Array.isArray(p.images?.gallery) ? p.images.gallery : [];
    const track = document.querySelector(".slider-track");
    if (g.length === 0) {
      track.innerHTML = `<img src="${p.images?.cover || 'img/placeholder.svg'}" class="slide" alt="cover" />`;
    } else {
      track.innerHTML = g.map(src => `<img src="${src}" class="slide" alt="gallery" />`).join("");
    }
    let idx = 0;
    const total = track.children.length;
    const update = () => {
      track.style.transform = `translateX(${-idx*100}%)`;
    };
    document.querySelector(".btn-prev").onclick = () => { idx = (idx-1+total)%total; update(); };
    document.querySelector(".btn-next").onclick = () => { idx = (idx+1)%total; update(); };
    update();

    // Receipts grid
    const r = Array.isArray(p.images?.receipts) ? p.images.receipts : [];
    const rwrap = document.querySelector(".receipt-preview.grid");
    rwrap.innerHTML = (r.length ? r : []).map(src => \`<div class="img-cell"><img src="\${src}" alt="receipt"></div>\`).join("");
  </script>

  </main>
  <footer class="footer">
    <div class="container">
      <small>Project.PAW — “도움은 본능, 연결은 선택.” 100% 전달 · 책임 구조 · 직접 연결</small>
    </div>
  </footer>
</body>
</html>
