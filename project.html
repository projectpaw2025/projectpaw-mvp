<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>프로젝트 상세</title>
<link rel="stylesheet" href="common.css"/>
<link rel="stylesheet" href="app.min.css"/>
<link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"/>
<style>
  :root{
    --ink:#111;
    --sub:#555;
    --accent:#E87722; /* 오렌지 포인트 */
    --line:#eaeaea;
    --bg:#fff;
  }
  body{margin:0;background:var(--bg);color:var(--ink);font-family:'SUIT Variable','Pretendard',sans-serif}
  .container{max-width:960px;margin:0 auto;padding:0 20px}
  section{padding:48px 0}

  h1{font-size:2rem;font-weight:900;margin:20px 0;color:var(--ink)}
  h2{font-size:1.3rem;font-weight:800;margin:32px 0 16px;color:var(--ink)}

  .hero{text-align:center;padding:40px 0}
  .hero img{max-width:100%;border-radius:16px;margin-bottom:20px}
  .badge{display:inline-block;background:var(--accent);color:#fff;
    padding:6px 12px;border-radius:8px;font-size:.9rem;font-weight:600;margin-bottom:12px}
  .progress{background:#eee;border-radius:6px;overflow:hidden;height:12px;margin:16px 0}
  .progress .bar{background:var(--accent);height:100%}
  .stats{display:flex;justify-content:space-between;font-size:.95rem;color:var(--sub);margin-bottom:18px}
  .stats span strong{font-size:1.15rem;font-weight:800;color:var(--ink);margin-left:4px}
  .btn-primary{display:inline-block;background:var(--accent);color:#fff;
    padding:12px 20px;border-radius:10px;font-weight:700;text-decoration:none;margin-top:16px}
  .muted{color:#888;font-size:.95rem}
  .gallery{display:flex;gap:12px;flex-wrap:wrap}
  .gallery img{width:calc(33% - 8px);border-radius:10px;border:1px solid #ddd}
  @media(max-width:768px){
    .stats{flex-direction:column;gap:8px}
    .gallery img{width:100%}
  }
</style>
</head>
<body>
  <!-- header include -->
  <div data-include="header"></div>

  <section class="hero">
    <div class="container">
      <span class="badge" id="status">진행중</span>
      <h1 id="title">프로젝트 제목</h1>
      <img id="cover" src="img/placeholder.svg" alt="대표 이미지"/>
      <div class="progress"><div class="bar" id="progress-bar" style="width:0%"></div></div>
      <div class="stats">
        <span>목표<strong id="goal">0</strong>원</span>
        <span>달성<strong id="current">0</strong>원</span>
        <span>참여자<strong id="supporters">0</strong>명</span>
      </div>
      <a href="#" class="btn-primary">후원하기</a>
    </div>
  </section>

  <section>
    <div class="container">
      <h2>프로젝트 스토리</h2>
      <p id="summary" class="muted"></p>
      <p id="description"></p>

      <h2>구조/치료 현황</h2>
      <div class="gallery" id="gallery"></div>
    </div>
  </section>

  <!-- footer include -->
  <div data-include="footer"></div>

  <script type="module">
    import { injectLayout } from './js/include.js';
    import { getProjectById } from './js/api.js';
    import { storage } from './js/firebase.js';
    import { ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

    injectLayout();

    const fmt = n => Number(n||0).toLocaleString('ko-KR');

    async function render(){
      const params=new URLSearchParams(location.search);
      const id=params.get('id');
      if(!id) return;

      try{
        const p=await getProjectById(id);
        if(!p) return;

        document.getElementById('title').textContent=p.name??'(제목 없음)';
        document.getElementById('summary').textContent=p.summary??'';
        document.getElementById('description').textContent=p.description??'';
        document.getElementById('goal').textContent=fmt(p.goalAmount);
        document.getElementById('current').textContent=fmt(p.currentAmount||0); // ✅ currentAmount 연동
        document.getElementById('supporters').textContent=p.supporterCount??0;
        document.getElementById('progress-bar').style.width=Math.min(100,Math.round((p.currentAmount||0)/p.goalAmount*100))+'%';
        document.getElementById('status').textContent=(p.adminApproved?'진행중':'대기중');

        if(p.representativeImageUrl){
          try{
            document.getElementById('cover').src=await getDownloadURL(ref(storage,p.representativeImageUrl));
          }catch(e){console.warn(e);}
        }

        if(Array.isArray(p.galleryUrls)){
          const gallery=document.getElementById('gallery');
          for(const path of p.galleryUrls){
            try{
              const url=await getDownloadURL(ref(storage,path));
              const img=document.createElement('img');
              img.src=url;
              gallery.appendChild(img);
            }catch(e){console.warn(e);}
          }
        }
      }catch(e){console.error(e);}
    }

    render();
  </script>
</body>
</html>
