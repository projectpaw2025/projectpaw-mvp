<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>프로젝트 상세 - Project.PAW</title>
  <link rel="stylesheet" href="common.css"/>
  <link rel="stylesheet" href="app.min.css"/>
  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"/>
  <style>
    :root{
      --ink:#111;
      --sub:#555;
      --accent:#E87722; /* 오렌지 포인트 */
      --line:#eaeaea;
      --bg:#fff;
    }
    body{margin:0;background:var(--bg);color:var(--ink);font-family:'SUIT Variable','Pretendard',sans-serif}
    .container{max-width:960px;margin:0 auto;padding:0 20px}
    section{padding:48px 0}

    h1{font-size:2rem;font-weight:900;margin:20px 0;color:var(--ink)}
    h2{font-size:1.3rem;font-weight:800;margin:32px 0 16px;color:var(--ink)}

    .hero{text-align:center;padding:40px 0}
    .hero img{max-width:100%;border-radius:16px;margin-bottom:20px}
    .badge{display:inline-block;background:var(--accent);color:#fff;
      padding:6px 12px;border-radius:8px;font-size:.9rem;font-weight:600;margin-bottom:12px}
    .progress{background:#eee;border-radius:6px;overflow:hidden;height:12px;margin:16px 0}
    .progress .bar{background:var(--accent);height:100%}
    .stats{display:flex;justify-content:space-between;font-size:.95rem;color:var(--sub);margin-bottom:18px}
    .stats span strong{font-size:1.15rem;font-weight:800;color:var(--ink);margin-left:4px}
    .btn-primary{display:inline-block;background:var(--accent);color:#fff;
      padding:12px 20px;border-radius:10px;font-weight:700;text-decoration:none;margin-top:16px}
    .muted{color:#888;font-size:.95rem}
    .gallery{display:flex;gap:12px;flex-wrap:wrap}
    .gallery img{width:calc(33% - 8px);border-radius:10px;border:1px solid #ddd}
    @media(max-width:768px){
      .stats{flex-direction:column;gap:8px}
      .gallery img{width:100%}
    }
  </style>
</head>
<body>
  <!-- header include -->
  <div data-include="header"></div>

  <section class="hero">
    <div class="container">
      <span class="badge" id="status-badge">진행중</span>
      <h1 id="project-title">프로젝트 제목</h1>
      <img id="project-image" src="img/placeholder.svg" alt="대표 이미지"/>
      <div class="progress"><div class="bar" id="progress-bar" style="width:0%"></div></div>
      <div class="stats">
        <span>목표<strong id="goal-amount">0</strong>원</span>
        <span>달성<strong id="current-amount">0</strong>원</span>
        <span>참여자<strong id="supporter-count">0</strong>명</span>
      </div>
      <a href="#" class="btn-primary">후원하기</a>
    </div>
  </section>

  <section>
    <div class="container">
      <h2>프로젝트 스토리</h2>
      <p id="project-story" class="muted">스토리 내용이 여기에 표시됩니다.</p>

      <h2>구조/치료 현황</h2>
      <div class="gallery" id="project-gallery"></div>

      <h2>공유하기</h2>
      <p class="muted">SNS/카카오톡 등을 통해 프로젝트를 공유해 주세요.</p>
    </div>
  </section>

  <!-- footer include -->
  <div data-include="footer"></div>

  <script type="module">
    import { injectLayout } from './js/include.js';
    import { apiGetProject } from './js/api.js';
    import { getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";
    import { storageRef } from './js/firebase.js';

    injectLayout();

    const params=new URLSearchParams(location.search);
    const id=params.get('id');
    const fmt=n=>Number(n||0).toLocaleString('ko-KR');

    async function render(){
      try{
        const p=await apiGetProject(id);
        if(!p)return;

        document.getElementById('project-title').textContent=p.name??'(제목 없음)';
        document.getElementById('goal-amount').textContent=fmt(p.goalAmount);
        document.getElementById('current-amount').textContent=fmt(p.currentAmount||0);
        document.getElementById('supporter-count').textContent=p.supporterCount??0;
        document.getElementById('progress-bar').style.width=Math.min(100,Math.round((p.currentAmount||0)/p.goalAmount*100))+'%';
        document.getElementById('status-badge').textContent=(p.adminApproved?'진행중':'대기중');

        if(p.summary) document.getElementById('project-story').textContent=p.summary;

        if(p.representativeImagePath){
          try{
            const url=await getDownloadURL(storageRef(p.representativeImagePath));
            document.getElementById('project-image').src=url;
          }catch(e){}
        }
        if(Array.isArray(p.images)){
          const gallery=await Promise.all(p.images.map(async path=>{
            try{return `<img src="${await getDownloadURL(storageRef(path))}" alt=""/>`;}catch(e){return '';}
          }));
          document.getElementById('project-gallery').innerHTML=gallery.join('');
        }
      }catch(e){console.error(e);}
    }
    render();
  </script>
</body>
</html>
