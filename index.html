<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Project.PAW — 개인과 개인을 잇는 후원 플랫폼</title>
  <link rel="stylesheet" href="common.css"/>
  <link rel="stylesheet" href="app.min.css"/>
  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"/>
  <style>
    :root{
      --ink:#111;
      --sub:#555;
      --accent:#E87722;
      --line:#eaeaea;
      --bg:#fff;
    }
    body{margin:0;background:var(--bg);color:var(--ink);
         font-family:'SUIT Variable','Pretendard','Inter',system-ui,sans-serif}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    section{padding:64px 0}

    /* Hero */
    .hero{text-align:center;padding:120px 20px 60px}
    .hero h1{margin:0 0 24px;font-size:2.8rem;font-weight:900;line-height:1.3;color:var(--ink)}
    .hero h1 span{color:var(--accent)}

    /* Grid & Cards */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:32px}
    .project-card{position:relative;border-radius:16px;overflow:hidden;background:#fff;transition:.3s;text-decoration:none;color:inherit}
    .project-card:hover{transform:translateY(-6px);box-shadow:0 10px 20px rgba(0,0,0,0.15)}

    .project-card .thumb{position:relative;height:220px;overflow:hidden}
    .project-card .thumb img{width:100%;height:100%;object-fit:cover}
    .project-card .overlay{
      position:absolute;top:0;left:0;right:0;bottom:0;
      display:flex;flex-direction:column;justify-content:flex-end;
      background:linear-gradient(to top,rgba(0,0,0,0.55),rgba(0,0,0,0));
      color:#fff;padding:16px
    }
    .project-card .overlay .badge{
      align-self:flex-start;
      background:var(--accent);color:#fff;padding:6px 12px;
      border-radius:8px;font-size:.9rem;font-weight:700;margin-bottom:auto
    }
    .project-card .overlay h3{font-size:1.3rem;font-weight:800;margin:0}
    .project-card .overlay .summary{margin:4px 0 0;font-size:1rem;opacity:.9}
    .project-card .overlay .hover-text{display:none;text-align:center;font-size:.95rem;font-weight:600}
    .project-card:hover .overlay .hover-text{display:block}

    .project-card .body{padding:16px;background:#fff}
    .project-card .hearts{color:var(--accent);font-weight:700;margin-bottom:6px}
    .project-card .key-message{color:var(--accent);font-weight:600;margin:6px 0}
    .progress{background:#eee;border-radius:6px;overflow:hidden;height:10px;margin:8px 0}
    .progress .bar{background:var(--accent);height:100%}
    .stats{display:flex;justify-content:space-between;font-size:.9rem;color:var(--sub);margin-top:6px}
    .stats span strong{font-weight:800;color:var(--ink);margin-left:4px}
  </style>
</head>
<body>
  <div data-include="header"></div>

  <section class="hero">
    <div class="container">
      <h1>개인↔개인을 연결하는, <span>직접 후원의 시작</span></h1>
      <p>#유기동물구조 #직접후원 #투명모금</p>
    </div>
  </section>

  <section class="projects">
    <div class="container">
      <h2 style="font-size:2rem;font-weight:900;margin-bottom:32px">진행 중인 프로젝트</h2>
      <div id="projects-grid" class="grid"><div class="muted">불러오는 중...</div></div>
    </div>
  </section>

  <div data-include="footer"></div>

  <script type="module">
    import { injectLayout } from './js/include.js';
    import { apiListProjects } from './js/api.js';
    injectLayout({ active:'home' });

    const $grid=document.getElementById('projects-grid');
    const fmt=n=>Number(n||0).toLocaleString('ko-KR');
    const cover=p=>
      p.representativeImageUrl||p.coverUrl||
      (Array.isArray(p.galleryUrls)&&p.galleryUrls[0])||
      (Array.isArray(p.images)&&p.images[0])||
      p.image||p.thumbnailUrl||'img/placeholder.svg';

    async function render(){
      try{
        const list=await apiListProjects({status:'approved',limit:12});
        if(!list.length){$grid.innerHTML='<div class="muted">아직 승인된 프로젝트가 없습니다.</div>';return;}
        $grid.innerHTML=list.map(p=>`
          <a class="project-card" href="project.html?id=${encodeURIComponent(p.id)}">
            <div class="thumb">
              <img src="${cover(p)}" alt=""/>
              <div class="overlay">
                <span class="badge">${p.adminApproved?'진행중':'대기중'}</span>
                <h3>${p.name??'(이름 없음)'}</h3>
                <p class="summary">${p.summary??''}</p>
                <div class="hover-text">자세히 보기 →</div>
              </div>
            </div>
            <div class="body">
              <div class="hearts">❤️ 연결된 마음 <strong>${p.supporterCount??0}</strong>명</div>
              ${p.keyMessage?`<p class="key-message">❝ ${p.keyMessage} ❞</p>`:''}
              <div class="progress"><div class="bar" style="width:${Math.min(100,Math.round((p.currentAmount||0)/p.goalAmount*100))}%"></div></div>
              <div class="stats">
                <span>목표<strong>${fmt(p.goalAmount)}</strong>원</span>
                <span>달성<strong>${fmt(p.currentAmount||0)}</strong>원</span>
              </div>
            </div>
          </a>
        `).join('');
      }catch(e){console.error(e);$grid.innerHTML='<div class="muted">프로젝트를 불러오지 못했습니다.</div>';}
    }
    render();
  </script>
</body>
</html>
