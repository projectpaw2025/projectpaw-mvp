<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Project.PAW</title>
  <link rel="stylesheet" href="common.css"/>
  <link rel="stylesheet" href="app.min.css"/>
  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"/>
  <style>
    :root{--ink:#111;--sub:#555;--accent:#E87722;--line:#eaeaea;--bg:#fff}
    html,body{margin:0;background:var(--bg);color:var(--ink);
      font-family:'SUIT Variable','Pretendard','Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    section{padding:60px 0}

    /* Hero */
    .hero{text-align:center;padding:120px 20px 40px}
    .hero h1{margin:0 0 18px;font-size:3rem;font-weight:900;line-height:1.28;color:var(--ink);position:relative;display:inline-block}
    .hero h1::after{content:"";position:absolute;left:0;bottom:-8px;width:100%;height:12px;background:var(--accent);z-index:-1;border-radius:4px}
    .hashtags{margin-top:16px;display:flex;flex-wrap:wrap;justify-content:center;gap:10px}
    .hashtags span{display:inline-block;background:#f2f2f2;color:#555;padding:6px 12px;border-radius:999px;font-size:.95rem;font-weight:700}

    /* Story Cards */
    .story-cards{background:var(--bg);padding:60px 0}
    .card-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:32px}
    @media(max-width:768px){.card-grid{grid-template-columns:1fr}}
    .story-card{background:#fff;border:2px solid var(--accent);border-radius:20px;padding:46px 36px;text-align:left;
      box-shadow:0 6px 14px rgba(0,0,0,0.06);display:flex;flex-direction:column}
    .card-top{display:flex;justify-content:space-between;align-items:center;font-size:1.05rem;font-weight:800;margin-bottom:18px;
      color:var(--accent);padding-bottom:14px;border-bottom:1px solid var(--line)}
    .story-card h2{font-size:2.1rem;font-weight:900;margin:0 0 28px;line-height:1.45;color:var(--ink)}
    .story-card p{margin:10px 0;font-size:1.2rem;font-weight:800;line-height:1.85;color:#111}
    .story-card .paw-words p{
      font-size:1.7rem;
      font-weight:900;
      line-height:1.8;
      margin:6px 0;
      font-family:'SUIT Variable','Pretendard','Inter',sans-serif;
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
    }
    .highlight{color:var(--accent)}

    /* Subnote */
    .subnote {
      font-size: 0.75rem;
      color: #aaa;
      margin-top: 10px;
      font-weight: 400;
      line-height: 1.4;
      font-style: italic;
    }

    /* Projects */
    .projects h2{margin:0;font-size:2rem;font-weight:900;color:var(--ink)}
    .projects .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:40px}
    .card{position:relative;display:flex;flex-direction:column;border-radius:20px;overflow:hidden;background:#fff;text-decoration:none;color:inherit;transition:.3s;min-height:420px}
    .card:hover{transform:translateY(-6px);box-shadow:0 12px 24px rgba(0,0,0,0.15)}
    .thumb{position:relative;height:240px;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .overlay{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:flex-end;
      background:linear-gradient(to top,rgba(0,0,0,0.55),rgba(0,0,0,0));color:#fff;padding:18px}
    .overlay .badge{align-self:flex-start;background:var(--accent);color:#fff;padding:6px 12px;border-radius:8px;font-size:.9rem;font-weight:700;margin-bottom:auto}
    .overlay h3{font-size:1.4rem;font-weight:800;margin:0;line-height:1.4}
    .overlay .summary{margin:6px 0 0;font-size:1rem;opacity:.9}
    .overlay .hover-text{display:none;text-align:center;font-size:.95rem;font-weight:600}
    .card:hover .overlay .hover-text{display:block}
    .card-body{padding:20px;background:#fff}
    .hearts{color:var(--accent);font-weight:700;margin-bottom:8px}
    .key-message{color:var(--ink);font-weight:600;margin:8px 0}
    .progress{background:#eee;border-radius:8px;overflow:hidden;height:12px;margin:10px 0}
    .progress .bar{background:var(--accent);height:100%}
    .stats{display:flex;justify-content:space-between;font-size:.95rem;color:var(--sub);margin-top:8px}
    .stats span strong{font-weight:800;color:var(--ink);margin-left:4px}
    .muted{color:#888}

    /* === CTA Dock (copied from project_list.html) === */
    .cta-dock{
      position:fixed;
      right:20px;
      bottom:20px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:50;
    }
    .cta-dock a{
      display:inline-block;
      padding:10px 14px;
      border-radius:10px;
      font-weight:700;
      font-size:.9rem;
      text-decoration:none;
      box-shadow:0 3px 8px rgba(0,0,0,0.12);
    }
    .btn-kakao{background:#FEE500;color:#111;}
    .btn-insta{background:#E4405F;color:#fff;}
    .btn-share{background:#6b7280;color:#fff;}
  </style>
</head>
<body>
  <div data-include="header"></div>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h1>ê°œì¸ê³¼ ê°œì¸ì„ ì—°ê²°í•˜ëŠ”, ì§ì ‘ í›„ì›ì˜ ì‹œì‘</h1>
      <div class="hashtags">
        <span>#ìœ ê¸°ë™ë¬¼êµ¬ì¡°</span><span>#ì§ì ‘í›„ì›</span><span>#íˆ¬ëª…ëª¨ê¸ˆ</span>
        <span>#ìœ ê¸°ë™ë¬¼ì¹˜ë£Œë¹„</span><span>#ì¤‘ì„±í™”ìˆ˜ìˆ </span><span>#ì…ì–‘ì§í›„ê²€ì§„/ì˜ˆë°©</span>
        <span>#íˆ¬ëª…í•œêµ¬ì¡°í™œë™</span><span>#ì‘ê¸‰ì¹˜ë£Œì§€ì›</span><span>#PAW = ê°œì¸ê³¼ ê°œì¸ì˜ ì—°ê²°, í•´í”¼ë¹ˆ/ê°™ì´ê°€ì¹˜ = ë‹¨ì²´ ì¤‘ì‹¬ í›„ì›</span>
      </div>
    </div>
  </section>

  <!-- Story Cards -->
  <section class="story-cards">
    <div class="container card-grid">
      <div class="story-card">
        <div class="card-top"><span>PROJECT PAW</span><span class="dots">â— â— â—</span></div>
        <h2>â ê·¸ë‚  ê·¸ êµ¬ì¡°ìëŠ” ì¹´ë“œ í•œë„ë¥¼ ë„˜ê²¼ë‹¤ â</h2>
        <div class="paw-words">
          <p><span class="highlight">P</span>ay It Forward</p>
          <p><span class="highlight">A</span>nd</p>
          <p><span class="highlight">W</span>eave warmth</p>
        </div>
      </div>
      <div class="story-card">
        <div class="card-top"><span>PROJECT PAW</span><span class="dots">â— â— â—</span></div>
        <h2>â ì—°ê²°ëœ ë§ˆìŒ â</h2>
        <p>Project.PAWëŠ” ê°œì¸ êµ¬ì¡°ìì™€ í›„ì›ìê°€ ì§ì ‘ ì—°ê²°ë˜ëŠ” ì‘ì€ ì‹¤í—˜ì…ë‹ˆë‹¤.</p>
        <p>ìˆ«ìë³´ë‹¤ ì¤‘ìš”í•œ ê±´ <span class="highlight">â€˜ì—°ê²°ëœ ë§ˆìŒâ€™</span>ì´ê³ ,</p>
        <p>ê·¸ ë§ˆìŒì´ í–‰ë™ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆë„ë¡ ë•ê³  ì‹¶ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>
  </section>

  <!-- Projects -->
  <section class="projects">
    <div class="container">
      <div class="header">
        <h2>ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸</h2>
        <a href="project_list.html" class="btn primary" style="color:#fff;background:var(--accent);padding:10px 16px;border-radius:8px;font-weight:700;text-decoration:none;">ëª¨ë‘ ë³´ê¸° â†’</a>
      </div>
      <div id="projects-grid" class="cards"><div class="muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
    </div>
  </section>

  <div data-include="footer"></div>

  <!-- === CTA Dock (same as project_list.html) === -->
  <div class="cta-dock">
    <a href="https://open.kakao.com/o/go3sJ0Kh" class="btn-kakao" target="_blank" rel="noopener noreferrer">ğŸ’¬ ë‹¨í†¡ë°©</a>
    <a href="https://www.instagram.com/projectpaw.kr/" class="btn-insta" target="_blank" rel="noopener noreferrer">ğŸ“· ì¸ìŠ¤íƒ€ê·¸ë¨</a>
    <a href="#" class="btn-share">ğŸ”— ë§í¬ ë³µì‚¬</a>
  </div>

  <script type="module">
    import { injectLayout } from './js/include.js';
    import { apiListProjects } from './js/api.js';
    import { storage } from './js/firebase.js';
    import { ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";
    injectLayout({ active:'home' });

    const $grid=document.getElementById('projects-grid');
    const fmt=n=>Number(n||0).toLocaleString('ko-KR');

    function candidatesOf(p){const out=[];const push=v=>{if(typeof v==='string'&&v.trim())out.push(v.trim());};
      ['representativeImageUrl','coverUrl','thumbnailUrl','image'].forEach(k=>push(p[k]));
      ['galleryUrls','images'].forEach(k=>{const arr=p[k];if(Array.isArray(arr))arr.forEach(it=>{if(typeof it==='string')push(it);else if(it&&(it.url||it.downloadUrl||it.path))push(it.url||it.downloadUrl||it.path);});});
      return out;}
    async function toHttpUrl(raw){if(!raw)return null;let v=String(raw).trim();if(/^(https?:|data:|blob:)/i.test(v))return v;if(v.startsWith('/'))v=v.slice(1);try{return await getDownloadURL(ref(storage,v));}catch(e){return null;}}
    async function coverUrlOf(p){for(const c of candidatesOf(p)){const u=await toHttpUrl(c);if(u)return u;}return 'img/placeholder.svg';}

    async function render(){
      try{
        const list=await apiListProjects({status:'approved',limit:8});
        if(!list.length){$grid.innerHTML='<div class="muted">ì•„ì§ ìŠ¹ì¸ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';return;}
        const withCovers=await Promise.all(list.map(async p=>({...p,_cover:await coverUrlOf(p)})));
        $grid.innerHTML=withCovers.map(p=>`
          <a class="card" href="project.html?id=${encodeURIComponent(p.id)}">
            <div class="thumb">
              <img src="${p._cover}" alt="cover"/>
              <div class="overlay">
                <span class="badge">${p.adminApproved?'ì§„í–‰ì¤‘':'ëŒ€ê¸°ì¤‘'}</span>
                <h3>PAW #${p.projectNumber ?? '-'} ${p.name??'(ì´ë¦„ ì—†ìŒ)'}</h3>
                <p class="summary">${p.summary??''}</p>
                <div class="hover-text">ìì„¸íˆ ë³´ê¸° â†’</div>
              </div>
            </div>
            <div class="card-body">
              <div class="hearts">â¤ï¸ ì—°ê²°ëœ ë§ˆìŒ <strong>${p.supporterCount??0}</strong>ëª…</div>
              ${p.keyMessage?`<p class="key-message">â ${p.keyMessage} â</p>`:''}
              <div class="progress"><div class="bar" style="width:${Math.min(100,Math.round((p.currentAmount||0)/p.goalAmount*100))}%"></div></div>
              <div class="stats">
                <span>ëª©í‘œ<strong>${fmt(p.goalAmount)}</strong>ì›</span>
                <span>ë‹¬ì„±<strong>${fmt(p.currentAmount||0)}</strong>ì›</span>
              </div>
            </div>
          </a>`).join('');
      }catch(e){console.error(e);$grid.innerHTML='<div class="muted">í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';}
    }
    render();
  </script>

  <!-- ë§í¬ ë³µì‚¬ ê¸°ëŠ¥ (CTA Dock) -->
  <script>
    document.querySelector(".btn-share")?.addEventListener("click", (e) => {
      e.preventDefault();
      navigator.clipboard.writeText(window.location.href)
        .then(() => alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."));
    });
  </script>
</body>
</html>
